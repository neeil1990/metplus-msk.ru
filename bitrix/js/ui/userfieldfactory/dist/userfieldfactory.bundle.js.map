{"version":3,"file":"userfieldfactory.bundle.js","sources":["../src/fieldtypes.js","../src/creationmenu.js","../src/enumitem.js","../src/configurator.js","../src/factory.js"],"sourcesContent":["import {Loc} from 'main.core';\n\nexport const MAX_FIELD_LENGTH = 50;\n\n/**\n * @memberof BX.UI.UserFieldFactory\n */\nexport class FieldTypes\n{\n\tstatic getTypes(): {}\n\t{\n\t\treturn Object.freeze({\n\t\t\tstring: 'string',\n\t\t\tenumeration: 'enumeration',\n\t\t\tdate: 'date',\n\t\t\tdatetime: 'datetime',\n\t\t\taddress: 'address',\n\t\t\turl: 'url',\n\t\t\tfile: 'file',\n\t\t\tmoney: 'money',\n\t\t\tboolean: 'boolean',\n\t\t\tdouble: 'double',\n\t\t\temployee: 'employee',\n\t\t\tcrm: 'crm',\n\t\t\tcrmStatus: 'crm_status',\n\t\t});\n\t}\n\n\tstatic getDescriptions(): {}\n\t{\n\t\treturn Object.freeze({\n\t\t\tstring: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_STRING_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_STRING_LEGEND\"),\n\t\t\t\tdefaultTitle: Loc.getMessage('UI_USERFIELD_FACTORY_UF_STRING_LABEL'),\n\t\t\t},\n\t\t\tenumeration: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_ENUM_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_ENUM_LEGEND\"),\n\t\t\t\tdefaultTitle: Loc.getMessage('UI_USERFIELD_FACTORY_UF_ENUMERATION_LABEL'),\n\t\t\t},\n\t\t\tdatetime: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_DATETIME_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_DATETIME_LEGEND\"),\n\t\t\t\tdefaultTitle: Loc.getMessage('UI_USERFIELD_FACTORY_UF_DATETIME_LABEL'),\n\t\t\t},\n\t\t\taddress: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_ADDRESS_TITLE_2\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_ADDRESS_LEGEND_2\"),\n\t\t\t},\n\t\t\turl: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_URL_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_URL_LEGEND\"),\n\t\t\t},\n\t\t\tfile: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_FILE_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_FILE_LEGEND\"),\n\t\t\t\tdefaultTitle: Loc.getMessage('UI_USERFIELD_FACTORY_UF_FILE_LABEL'),\n\t\t\t},\n\t\t\tmoney: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_MONEY_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_MONEY_LEGEND\"),\n\t\t\t\tdefaultTitle: Loc.getMessage('UI_USERFIELD_FACTORY_UF_MONEY_LABEL'),\n\t\t\t},\n\t\t\tboolean: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_BOOLEAN_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_BOOLEAN_LEGEND\"),\n\t\t\t},\n\t\t\tdouble: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_DOUBLE_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_DOUBLE_LEGEND\"),\n\t\t\t\tdefaultTitle: Loc.getMessage('UI_USERFIELD_FACTORY_UF_DOUBLE_LABEL'),\n\t\t\t},\n\t\t\temployee: {\n\t\t\t\ttitle: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_EMPLOYEE_TITLE\"),\n\t\t\t\tdescription: Loc.getMessage(\"UI_USERFIELD_FACTORY_UF_EMPLOYEE_LEGEND\"),\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic getCustomTypeDescription(): {}\n\t{\n\t\treturn Object.freeze({\n\t\t\tname: 'custom',\n\t\t\ttitle: Loc.getMessage('UI_USERFIELD_FACTORY_UF_CUSTOM_TITLE'),\n\t\t\tdescription: Loc.getMessage('UI_USERFIELD_FACTORY_UF_CUSTOM_LEGEND'),\n\t\t});\n\t}\n}\n\nexport const DefaultData = Object.freeze({\n\tmultiple: 'N',\n\tmandatory: 'N',\n\tuserTypeId: FieldTypes.string,\n\tshowFilter: 'E',\n\tshowInList: 'Y',\n\tsettings: {},\n\tisSearchable: 'N',\n});\n\nexport const DefaultFieldData = Object.freeze({\n\tfile: {\n\t\tshowFilter: 'N',\n\t\tshowInList: 'N',\n\t},\n\temployee: {\n\t\tshowFilter: 'I',\n\t},\n\tcrm: {\n\t\tshowFilter: 'I',\n\t},\n\tcrm_status: {\n\t\tshowFilter: 'I',\n\t},\n\tenumeration: {\n\t\tsettings: {\n\t\t\tDISPLAY: 'UI',\n\t\t},\n\t},\n\tdouble: {\n\t\tsettings: {\n\t\t\tPRECISION: 2,\n\t\t},\n\t},\n});","import {Dom, Event, Type, Tag} from 'main.core';\nimport {Popup} from 'main.popup';\n\nconst SCROLL_OFFSET = 3;\n\n/**\n * @memberof BX.UI.UserFieldFactory\n */\nexport class CreationMenu\n{\n\t#enableScrollToBottom: boolean;\n\t#enableScrollToTop: boolean;\n\n\tconstructor(id: string, types: Array, params: Object)\n\t{\n\t\tthis.id = id;\n\t\tthis.items = types;\n\t\tthis.params = {};\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tthis.params = params;\n\t\t}\n\t}\n\n\tgetId(): string\n\t{\n\t\tif(!this.id)\n\t\t{\n\t\t\treturn 'ui-user-field-factory-menu';\n\t\t}\n\n\t\treturn this.id;\n\t}\n\n\tgetPopup(onItemClick = null): Popup\n\t{\n\t\tif(!this.popup)\n\t\t{\n\t\t\tlet options = {...CreationMenu.getDefaultPopupOptions(), ...this.params};\n\n\t\t\toptions.events = {\n\t\t\t\tonPopupShow: this.onPopupShow.bind(this),\n\t\t\t\tonPopupDestroy: this.onPopupDestroy.bind(this),\n\t\t\t};\n\t\t\toptions.id = this.getId();\n\n\t\t\tthis.popup = new Popup(options);\n\t\t}\n\n\t\tthis.popup.setContent(this.render(onItemClick));\n\n\t\treturn this.popup;\n\t}\n\n\tstatic getDefaultPopupOptions(): Object\n\t{\n\t\treturn {\n\t\t\tautoHide: true,\n\t\t\tdraggable: false,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tnoAllPaddings: true,\n\t\t\tbindOptions: { forceBindPosition: true },\n\t\t\tcloseByEsc: true,\n\t\t\tcacheable: false,\n\t\t};\n\t}\n\n\topen(callback: function): void\n\t{\n\t\tconst popup = this.getPopup(callback);\n\t\tif(!popup.isShown())\n\t\t{\n\t\t\tpopup.show();\n\t\t}\n\t}\n\n\trender(onItemClick): Element\n\t{\n\t\tif(!this.container)\n\t\t{\n\t\t\tthis.container = Tag.render`<div class=\"ui-userfieldfactory-creation-menu-container\"></div>`;\n\n\t\t\tconst scrollIcon = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"42\\\" height=\\\"13\\\" viewBox=\\\"0 0 42 13\\\">\\n\" +\n\t\t\t\t\"  <polyline fill=\\\"none\\\" stroke=\\\"#CACDD1\\\" stroke-width=\\\"2\\\" points=\\\"274 98 284 78.614 274 59\\\" transform=\\\"rotate(90 186 -86.5)\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"/>\\n\" +\n\t\t\t\t\"</svg>\\n\";\n\n\t\t\tthis.topScrollButton = Tag.render`<div class=\"ui-userfieldfactory-creation-menu-scroll-top\">${scrollIcon}</div>`;\n\t\t\tthis.bottomScrollButton = Tag.render`<div class=\"ui-userfieldfactory-creation-menu-scroll-bottom\">${scrollIcon}</div>`;\n\n\t\t\tthis.container.appendChild(this.topScrollButton);\n\t\t\tthis.container.appendChild(this.bottomScrollButton);\n\n\t\t\tthis.container.appendChild(this.renderList(onItemClick));\n\t\t}\n\n\t\treturn this.container;\n\t}\n\n\trenderList(onItemClick): Element\n\t{\n\t\tif(!this.containerList)\n\t\t{\n\t\t\tthis.containerList = Tag.render`<div class=\"ui-userfieldfactory-creation-menu-list\"></div>`;\n\n\t\t\tthis.items.forEach((item) =>\n\t\t\t{\n\t\t\t\tthis.containerList.appendChild(this.renderItem(item, onItemClick));\n\t\t\t});\n\t\t}\n\n\t\treturn this.containerList;\n\t}\n\n\trenderItem(item, onClick): Element\n\t{\n\t\treturn Tag.render`<div class=\"ui-userfieldfactory-creation-menu-item\" onclick=\"${(()=>{this.handleItemClick(item, onClick);})}\">\n\t\t\t<div class=\"ui-userfieldfactory-creation-menu-item-title\">${item.title}</div>\n\t\t\t<div class=\"ui-userfieldfactory-creation-menu-item-desc\">${item.description}</div>\n\t\t</div>`;\n\t}\n\n\thandleItemClick(item, onClick)\n\t{\n\t\tif(Type.isFunction(item.onClick))\n\t\t{\n\t\t\titem.onClick(item.name);\n\t\t}\n\t\telse if(Type.isFunction(onClick))\n\t\t{\n\t\t\tonClick(item.name);\n\t\t}\n\t\tthis.getPopup().close();\n\t}\n\n\tonPopupShow()\n\t{\n\t\tEvent.bind(this.bottomScrollButton, \"mouseover\", this.onBottomButtonMouseOver.bind(this));\n\t\tEvent.bind(this.bottomScrollButton, \"mouseout\", this.onBottomButtonMouseOut.bind(this));\n\t\tEvent.bind(this.topScrollButton, \"mouseover\", this.onTopButtonMouseOver.bind(this));\n\t\tEvent.bind(this.topScrollButton, \"mouseout\", this.onTopButtonMouseOut.bind(this));\n\t\tEvent.bind(this.containerList, \"scroll\", this.onScroll.bind(this));\n\n\t\twindow.setTimeout(this.adjust.bind(this), 100);\n\t}\n\n\tonPopupDestroy()\n\t{\n\t\tEvent.unbind(this.bottomScrollButton, \"mouseover\", this.onBottomButtonMouseOver.bind(this));\n\t\tEvent.unbind(this.bottomScrollButton, \"mouseout\", this.onBottomButtonMouseOut.bind(this));\n\t\tEvent.unbind(this.topScrollButton, \"mouseover\", this.onTopButtonMouseOver.bind(this));\n\t\tEvent.unbind(this.topScrollButton, \"mouseout\", this.onTopButtonMouseOut.bind(this));\n\t\tEvent.unbind(this.containerList, \"scroll\", this.onScroll.bind(this));\n\n\t\tthis.container = null;\n\t\tthis.containerList = null;\n\t\tthis.topScrollButton = null;\n\t\tthis.bottomScrollButton = null;\n\n\t\tthis.popup = null;\n\t}\n\n\tonBottomButtonMouseOver()\n\t{\n\t\tif(this.#enableScrollToBottom)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#enableScrollToBottom = true;\n\t\tthis.#enableScrollToTop = false;\n\n\t\t(function scroll()\n\t\t{\n\t\t\tif(!this.#enableScrollToBottom)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif((this.containerList.scrollTop + this.containerList.offsetHeight) !== this.containerList.scrollHeight)\n\t\t\t{\n\t\t\t\tthis.containerList.scrollTop += SCROLL_OFFSET;\n\t\t\t}\n\n\t\t\tif((this.containerList.scrollTop + this.containerList.offsetHeight) === this.containerList.scrollHeight)\n\t\t\t{\n\t\t\t\tthis.#enableScrollToBottom = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twindow.setTimeout(scroll.bind(this), 20);\n\t\t\t}\n\t\t}).bind(this)();\n\t}\n\n\tonBottomButtonMouseOut()\n\t{\n\t\tthis.#enableScrollToBottom = false;\n\t}\n\n\tonTopButtonMouseOver()\n\t{\n\t\tif(this.#enableScrollToTop)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#enableScrollToBottom = false;\n\t\tthis.#enableScrollToTop = true;\n\n\t\t(function scroll()\n\t\t{\n\t\t\tif(!this.#enableScrollToTop)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif(this.containerList.scrollTop > 0)\n\t\t\t{\n\t\t\t\tthis.containerList.scrollTop -= SCROLL_OFFSET;\n\t\t\t}\n\n\t\t\tif(this.containerList.scrollTop === 0)\n\t\t\t{\n\t\t\t\tthis.#enableScrollToTop = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twindow.setTimeout(scroll.bind(this), 20);\n\t\t\t}\n\t\t}).bind(this)();\n\t}\n\n\tonTopButtonMouseOut()\n\t{\n\t\tthis.#enableScrollToTop = false;\n\t}\n\n\tonScroll()\n\t{\n\t\tthis.adjust();\n\t}\n\n\tadjust()\n\t{\n\t\tconst height = this.containerList.offsetHeight;\n\t\tconst scrollTop = this.containerList.scrollTop;\n\t\tconst scrollHeight = this.containerList.scrollHeight;\n\n\t\tif(scrollTop === 0)\n\t\t{\n\t\t\tDom.hide(this.topScrollButton);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.show(this.topScrollButton);\n\t\t}\n\n\t\tif((scrollTop + height) === scrollHeight)\n\t\t{\n\t\t\tDom.hide(this.bottomScrollButton);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.show(this.bottomScrollButton);\n\t\t}\n\t}\n}","/**\n * @memberof BX.UI.UserFieldFactory\n */\nexport class EnumItem\n{\n\tconstructor(value = null, id = null)\n\t{\n\t\tthis.value = value;\n\t\tthis.id = id;\n\t}\n\n\tsetNode(node: Element)\n\t{\n\t\tthis.node = node;\n\t}\n\n\tgetId(): ?number\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetNode(): ?Element\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetInput(): ?Element\n\t{\n\t\tconst node = this.getNode();\n\t\tif(!node)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tif(node instanceof HTMLInputElement)\n\t\t{\n\t\t\treturn node;\n\t\t}\n\t\treturn node.querySelector('input');\n\t}\n\n\tgetValue(): string\n\t{\n\t\tconst input = this.getInput();\n\t\tif(input && input.value)\n\t\t{\n\t\t\treturn input.value;\n\t\t}\n\n\t\treturn this.value || '';\n\t}\n}","import {Type, Loc, Tag, Text} from 'main.core';\nimport {UserField} from 'ui.userfield';\nimport {FieldTypes} from \"./fieldtypes\";\nimport {EnumItem} from './enumitem';\n\n/**\n * @memberof BX.UI.UserFieldFactory\n */\nexport class Configurator\n{\n\tconstructor(params: {\n\t\tuserField: UserField,\n\t\tonSave: Function,\n\t\tonCancel: ?Function,\n\t})\n\t{\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(params.userField)\n\t\t\t{\n\t\t\t\tthis.userField = params.userField;\n\t\t\t}\n\t\t\tif(Type.isFunction(params.onSave))\n\t\t\t{\n\t\t\t\tthis.onSave = params.onSave;\n\t\t\t}\n\t\t\tif(Type.isFunction(params.onCancel))\n\t\t\t{\n\t\t\t\tthis.onCancel = params.onCancel;\n\t\t\t}\n\t\t}\n\n\t\tthis.enumItems = new Set();\n\t}\n\n\trender(): Element\n\t{\n\t\tthis.node = Tag.render`<div class=\"ui-userfieldfactory-configurator\"></div>`;\n\n\t\tthis.labelInput = Tag.render`<input class=\"ui-ctl-element\" type=\"text\" value=\"${Text.encode(this.userField.getTitle())}\" />`;\n\n\t\tthis.node.appendChild(Tag.render`<div class=\"ui-userfieldfactory-configurator-block\">\n\t\t\t<div class=\"ui-userfieldfactory-configurator-title\">\n\t\t\t\t<span class=\"ui-userfieldfactory-configurator-title-text\">${Loc.getMessage('UI_USERFIELD_FACTORY_CONFIGURATOR_FIELD_TITLE')}</span>\n\t\t\t</div>\n\t\t\t<div class=\"ui-userfieldfactory-configurator-content\">\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t${this.labelInput}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`);\n\n\t\tif(this.userField.getUserTypeId() === FieldTypes.getTypes().enumeration)\n\t\t{\n\t\t\tthis.node.appendChild(this.renderEnumeration());\n\t\t}\n\n\t\tthis.node.appendChild(this.renderOptions());\n\n\t\tconst save = (event) =>\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t\tif(Type.isFunction(this.onSave))\n\t\t\t{\n\t\t\t\tthis.onSave(this.saveField());\n\t\t\t}\n\t\t};\n\n\t\tconst cancel = (event) =>\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t\tif(Type.isFunction(this.onCancel))\n\t\t\t{\n\t\t\t\tthis.onCancel();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.node.style.display = 'none';\n\t\t\t}\n\t\t};\n\n\t\tthis.saveButton = Tag.render`<span class=\"ui-btn ui-btn-primary\" onclick=\"${save.bind(this)}\">${Loc.getMessage('UI_USERFIELD_SAVE')}</span>`;\n\t\tthis.cancelButton = Tag.render`<span class=\"ui-btn ui-btn-light-border\" onclick=\"${cancel.bind(this)}\">${Loc.getMessage('UI_USERFIELD_CANCEL')}</span>`;\n\n\t\tthis.node.appendChild(Tag.render`<div class=\"ui-userfieldfactory-configurator-block\">\n\t\t\t${this.saveButton}${this.cancelButton}\n\t\t</div>`);\n\n\t\treturn this.node;\n\t}\n\n\tsaveField(): UserField\n\t{\n\t\tif(this.timeCheckbox)\n\t\t{\n\t\t\tif(this.timeCheckbox.checked)\n\t\t\t{\n\t\t\t\tthis.userField.setUserTypeId(FieldTypes.getTypes().datetime);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.userField.setUserTypeId(FieldTypes.getTypes().date);\n\t\t\t}\n\t\t}\n\t\tif(this.multipleCheckbox)\n\t\t{\n\t\t\tthis.userField.setIsMultiple(this.multipleCheckbox.checked);\n\t\t}\n\t\tthis.userField.setTitle(this.labelInput.value);\n\t\tthis.userField.setIsMandatory(this.mandatoryCheckbox.checked);\n\t\tthis.saveEnumeration(this.userField, this.enumItems);\n\n\t\treturn this.userField;\n\t}\n\n\trenderEnumeration(): Element\n\t{\n\t\tthis.enumItemsContainer = Tag.render`<div class=\"ui-userfieldfactory-configurator-block\"></div>`;\n\n\t\tthis.enumAddItemContainer = Tag.render`<div class=\"ui-userfieldfactory-configurator-block-add-field\">\n\t\t\t<span class=\"ui-userfieldfactory-configurator-add-button\" onclick=\"${() => {this.addEnumInput().focus();}}\">${Loc.getMessage('UI_USERFIELD_ADD')}</span>\n\t\t</div>`;\n\n\t\tthis.enumContainer = Tag.render`<div class=\"ui-userfieldfactory-configurator-block\">\n\t\t\t<div class=\"ui-userfieldfactory-configurator-title\">\n\t\t\t\t<span class=\"ui-userfieldfactory-configurator-title-text\">${Loc.getMessage('UI_USERFIELD_FACTORY_UF_ENUM_ITEMS')}</span>\n\t\t\t</div>\n\t\t\t${this.enumItemsContainer}\n\t\t\t${this.enumAddItemContainer}\n\t\t</div>`;\n\n\t\tthis.userField.getEnumeration().forEach((item) =>\n\t\t{\n\t\t\tthis.addEnumInput(item);\n\t\t});\n\t\tthis.addEnumInput();\n\n\t\treturn this.enumContainer;\n\t}\n\n\taddEnumInput(item: ?{\n\t\tvalue: string,\n\t\tid: ?number,\n\t}): Element\n\t{\n\t\tlet enumItem;\n\t\tif(Type.isPlainObject(item))\n\t\t{\n\t\t\tenumItem = new EnumItem(item.value, item.id);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tenumItem = new EnumItem();\n\t\t}\n\n\t\tconst node = Tag.render`<div style=\"margin-bottom: 10px;\" class=\"ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-row\">\n\t\t\t<input class=\"ui-ctl-element\" type=\"text\" value=\"${Text.encode(enumItem.getValue())}\">\n\t\t\t<div class=\"ui-userfieldfactory-configurator-remove-enum\" onclick=\"${(event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.deleteEnumItem(enumItem);\n\t\t\t}}\"></div>\n\t\t</div>`;\n\n\t\tenumItem.setNode(node);\n\n\t\tthis.enumItems.add(enumItem);\n\n\t\tthis.enumItemsContainer.appendChild(node);\n\n\t\treturn node;\n\t}\n\n\tdeleteEnumItem(item: EnumItem)\n\t{\n\t\tthis.enumItemsContainer.removeChild(item.getNode());\n\t\tthis.enumItems.delete(item);\n\t}\n\n\trenderOptions(): Element\n\t{\n\t\tthis.optionsContainer = Tag.render`<div class=\"ui-userfieldfactory-configurator-block\"></div>`;\n\n\t\tthis.mandatoryCheckbox = Tag.render`<input class=\"ui-ctl-element\" type=\"checkbox\">`;\n\t\tthis.mandatoryCheckbox.checked = (this.userField.isMandatory());\n\t\tthis.optionsContainer.appendChild(Tag.render`<div>\n\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox ui-ctl-xs\">\n\t\t\t\t\t${this.mandatoryCheckbox}\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('UI_USERFIELD_FACTORY_FIELD_REQUIRED')}</div>\n\t\t\t\t</label>\n\t\t\t</div>`);\n\n\t\tif(!this.userField.isSaved() && (this.userField.getUserTypeId() === FieldTypes.getTypes().date || this.userField.getUserTypeId() === FieldTypes.getTypes().datetime))\n\t\t{\n\t\t\tthis.timeCheckbox = Tag.render`<input class=\"ui-ctl-element\" type=\"checkbox\">`;\n\t\t\tthis.timeCheckbox.checked = (this.userField.getUserTypeId() === FieldTypes.getTypes().datetime);\n\t\t\tthis.optionsContainer.appendChild(Tag.render`<div>\n\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox ui-ctl-xs\">\n\t\t\t\t\t${this.timeCheckbox}\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('UI_USERFIELD_FACTORY_UF_ENABLE_TIME')}</div>\n\t\t\t\t</label>\n\t\t\t</div>`);\n\t\t}\n\n\t\tif(!this.userField.isSaved() && this.userField.getUserTypeId() !== FieldTypes.getTypes().boolean)\n\t\t{\n\t\t\tthis.multipleCheckbox = Tag.render`<input class=\"ui-ctl-element\" type=\"checkbox\">`;\n\t\t\tthis.multipleCheckbox.checked = this.userField.isMultiple();\n\t\t\tthis.optionsContainer.appendChild(Tag.render`<div>\n\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox ui-ctl-xs\">\n\t\t\t\t\t${this.multipleCheckbox}\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('UI_USERFIELD_FACTORY_FIELD_MULTIPLE')}</div>\n\t\t\t\t</label>\n\t\t\t</div>`);\n\t\t}\n\n\t\treturn this.optionsContainer;\n\t}\n\n\tsaveEnumeration(userField: UserField, enumItems: EnumItem[])\n\t{\n\t\tconst items = [];\n\t\tlet sort = 100;\n\n\t\tenumItems.forEach((item) =>\n\t\t{\n\t\t\titems.push({\n\t\t\t\tvalue: item.getValue(),\n\t\t\t\tsort: sort,\n\t\t\t\tid: item.getId(),\n\t\t\t});\n\n\t\t\tsort += 100;\n\t\t});\n\n\t\tuserField.setEnumeration(items);\n\t}\n}","import {Loc, Type, Reflection} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\n\nimport {CreationMenu} from \"./creationmenu\";\nimport {UserField} from 'ui.userfield';\nimport {MAX_FIELD_LENGTH, DefaultData, DefaultFieldData, FieldTypes} from \"./fieldtypes\";\nimport {Configurator} from \"./configurator\";\n\nimport 'sidepanel';\nimport 'uf';\n\n/**\n * @memberof BX.UI.UserFieldFactory\n * @mixes EventEmitter\n */\nexport class Factory\n{\n\tconstructor(entityId: string, params: {\n\t\tmenuId: ?string,\n\t\ttypes: ?Array,\n\t\tbindElement: ?Element,\n\t\tconfiguratorClass: ?Configurator,\n\t\tcustomTypesUrl: ?string,\n\t\tmoduleId: ?string,\n\t} = {})\n\t{\n\t\tEventEmitter.makeObservable(this, 'BX.UI.UserFieldFactory.Factory');\n\t\tthis.configuratorClass = Configurator;\n\t\tif(Type.isString(entityId) && entityId.length > 0)\n\t\t{\n\t\t\tthis.entityId = entityId;\n\t\t}\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(Type.isString(params.menuId))\n\t\t\t{\n\t\t\t\tthis.menuId = params.menuId;\n\t\t\t}\n\t\t\tif(!Type.isArray(params.types))\n\t\t\t{\n\t\t\t\tparams.types = [];\n\t\t\t}\n\t\t\tif(Type.isDomNode(params.bindElement))\n\t\t\t{\n\t\t\t\tthis.bindElement = params.bindElement;\n\t\t\t}\n\t\t\tthis.moduleId = params.moduleId;\n\t\t\tthis.setCustomTypesUrl(params.customTypesUrl)\n\t\t\t\t.setConfiguratorClass(params.configuratorClass);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tparams.types = [];\n\t\t}\n\t\tthis.types =  this.getFieldTypes().concat(params.types);\n\t}\n\n\tgetFieldTypes(): Array\n\t{\n\t\tconst types = [];\n\n\t\tObject.keys(FieldTypes.getDescriptions()).forEach((name) =>\n\t\t{\n\t\t\ttypes.push({...FieldTypes.getDescriptions()[name], ...{name}});\n\t\t});\n\n\t\tthis.emit('OnGetUserTypes', {\n\t\t\ttypes\n\t\t});\n\n\t\treturn types;\n\t}\n\n\tgetMenu(params: Object): CreationMenu\n\t{\n\t\tif(!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\t\tif(!Type.isDomNode(params.bindElement))\n\t\t{\n\t\t\tparams.bindElement = this.bindElement;\n\t\t}\n\t\tconst types = this.types;\n\t\tif(this.customTypesUrl && !this.isCustomTypeAdded)\n\t\t{\n\t\t\tconst customType = {...FieldTypes.getCustomTypeDescription()};\n\t\t\tcustomType.onClick = this.onCustomTypeClick.bind(this);\n\t\t\ttypes.push(customType);\n\t\t\tthis.isCustomTypeAdded = true;\n\t\t}\n\t\tif(!this.menu)\n\t\t{\n\t\t\tthis.menu = new CreationMenu(this.menuId, types, params);\n\t\t}\n\n\t\treturn this.menu;\n\t}\n\n\tsetConfiguratorClass(configuratorClassName: string|Function)\n\t{\n\t\tlet configuratorClass = null;\n\t\tif(Type.isString(configuratorClassName))\n\t\t{\n\t\t\tconfiguratorClass = Reflection.getClass(configuratorClassName);\n\t\t}\n\t\telse if(Type.isFunction(configuratorClassName))\n\t\t{\n\t\t\tconfiguratorClass = configuratorClassName;\n\t\t}\n\n\t\tif(Type.isFunction(configuratorClass) && configuratorClass.prototype instanceof Configurator)\n\t\t{\n\t\t\tthis.configuratorClass = configuratorClass;\n\t\t}\n\t}\n\n\tsetCustomTypesUrl(customTypesUrl: string): this\n\t{\n\t\tthis.customTypesUrl = customTypesUrl;\n\n\t\treturn this;\n\t}\n\n\tgetConfigurator(params: {\n\t\tuserField: UserField,\n\t\tonSave: Function,\n\t\tonCancel: ?Function,\n\t}): Configurator\n\t{\n\t\treturn new this.configuratorClass(params);\n\t}\n\n\tcreateUserField(fieldType: string, fieldName: ?string): UserField\n\t{\n\t\tlet data = {...DefaultData, ...DefaultFieldData[fieldType], ...{userTypeId: fieldType}};\n\n\t\tif(!Type.isString(fieldName) || fieldName.length <= 0 || fieldName.length > MAX_FIELD_LENGTH)\n\t\t{\n\t\t\tfieldName = this.generateFieldName();\n\t\t}\n\t\tdata.fieldName = fieldName;\n\t\tdata.entityId = this.entityId;\n\n\t\tconst userField = new UserField(data, {\n\t\t\tmoduleId: this.moduleId,\n\t\t});\n\t\tuserField.setTitle(this.getDefaultLabel(fieldType));\n\n\t\tthis.emit('onCreateField', {\n\t\t\tuserField,\n\t\t});\n\n\t\treturn userField;\n\t}\n\n\tgetDefaultLabel(fieldType: string): string\n\t{\n\t\tlet label = Loc.getMessage('UI_USERFIELD_FACTORY_UF_LABEL');\n\t\tthis.types.forEach((type) =>\n\t\t{\n\t\t\tif(type.name === fieldType && Type.isString(type.defaultTitle))\n\t\t\t{\n\t\t\t\tlabel = type.defaultTitle;\n\t\t\t}\n\t\t});\n\n\t\treturn label;\n\t}\n\n\tgenerateFieldName(): string\n\t{\n\t\tlet name = 'UF_' + (this.entityId ? (this.entityId + \"_\") : \"\");\n\t\tlet dateSuffix = (new Date()).getTime().toString();\n\t\tif(name.length + dateSuffix.length > MAX_FIELD_LENGTH)\n\t\t{\n\t\t\tdateSuffix = dateSuffix.substr(((name.length + dateSuffix.length) - MAX_FIELD_LENGTH));\n\t\t}\n\n\t\tname += dateSuffix;\n\n\t\treturn name;\n\t}\n\n\tonCustomTypeClick()\n\t{\n\t\tif(!this.customTypesUrl)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tBX.SidePanel.Instance.open(this.customTypesUrl.toString(), {\n\t\t\tcacheable: false,\n\t\t\tallowChangeHistory: false,\n\t\t\twidth: 900,\n\t\t\tevents: {\n\t\t\t\tonClose: (event) => {\n\t\t\t\t\tconst slider = event.getSlider();\n\t\t\t\t\tif(slider)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst userFieldData = slider.getData().get('userFieldData');\n\t\t\t\t\t\tif(userFieldData)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst userField = UserField.unserialize(userFieldData);\n\t\t\t\t\t\t\tthis.emit('onCreateCustomUserField', {userField});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}"],"names":["MAX_FIELD_LENGTH","FieldTypes","Object","freeze","string","enumeration","date","datetime","address","url","file","money","employee","crm","crmStatus","title","Loc","getMessage","description","defaultTitle","name","DefaultData","multiple","mandatory","userTypeId","showFilter","showInList","settings","isSearchable","DefaultFieldData","crm_status","DISPLAY","PRECISION","SCROLL_OFFSET","CreationMenu","id","types","params","items","Type","isPlainObject","onItemClick","popup","options","getDefaultPopupOptions","events","onPopupShow","bind","onPopupDestroy","getId","Popup","setContent","render","callback","getPopup","isShown","show","container","Tag","scrollIcon","topScrollButton","bottomScrollButton","appendChild","renderList","containerList","forEach","item","renderItem","onClick","handleItemClick","isFunction","close","Event","onBottomButtonMouseOver","onBottomButtonMouseOut","onTopButtonMouseOver","onTopButtonMouseOut","onScroll","window","setTimeout","adjust","unbind","scroll","scrollTop","offsetHeight","scrollHeight","height","Dom","hide","autoHide","draggable","offsetLeft","offsetTop","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","cacheable","EnumItem","value","node","getNode","HTMLInputElement","querySelector","input","getInput","Configurator","userField","onSave","onCancel","enumItems","Set","labelInput","Text","encode","getTitle","getUserTypeId","getTypes","renderEnumeration","renderOptions","save","event","preventDefault","saveField","cancel","style","display","saveButton","cancelButton","timeCheckbox","checked","setUserTypeId","multipleCheckbox","setIsMultiple","setTitle","setIsMandatory","mandatoryCheckbox","saveEnumeration","enumItemsContainer","enumAddItemContainer","addEnumInput","focus","enumContainer","getEnumeration","enumItem","getValue","deleteEnumItem","setNode","add","removeChild","optionsContainer","isMandatory","isSaved","isMultiple","sort","push","setEnumeration","Factory","entityId","EventEmitter","makeObservable","configuratorClass","isString","length","menuId","isArray","isDomNode","bindElement","moduleId","setCustomTypesUrl","customTypesUrl","setConfiguratorClass","getFieldTypes","concat","keys","getDescriptions","emit","isCustomTypeAdded","customType","getCustomTypeDescription","onCustomTypeClick","menu","configuratorClassName","Reflection","getClass","prototype","fieldType","fieldName","data","generateFieldName","UserField","getDefaultLabel","label","type","dateSuffix","Date","getTime","toString","substr","BX","SidePanel","Instance","open","allowChangeHistory","width","onClose","slider","getSlider","userFieldData","getData","get","unserialize"],"mappings":"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"}